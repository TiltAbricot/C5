<!-- Complete Circle of Fifths App with Binary-Based Shape Names (Version 0.1.9.1) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Circle of Fifths</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      font-family: sans-serif;
    }
    svg {
      width: 90vw;
      height: 90vw;
      max-width: 500px;
      max-height: 500px;
    }
    circle.note {
      fill: white;
      stroke: black;
      cursor: pointer;
    }
    circle.fundamental {
      stroke: red;
      stroke-width: 3;
    }
    text {
      font-size: 14px;
      text-anchor: middle;
      alignment-baseline: middle;
      pointer-events: none;
    }
    polygon {
      stroke-width: 2;
    }
    .controls {
      width: 100%;
      max-width: 500px;
      display: flex;
      flex-direction: column;
      gap: 1em;
      margin-top: 20px;
    }
    label {
      font-weight: bold;
    }
    select, button {
      padding: 0.5em;
      font-size: 16px;
    }
    #chord-name {
      font-size: 18px;
      font-weight: bold;
      margin-top: 1em;
      text-align: center;
    }
    #app-version {
      margin-top: 1em;
      color: gray;
      font-size: 14px;
      text-align: center;
    }
    .shape-list {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .shape-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f0f0f0;
      padding: 5px 10px;
      border-radius: 5px;
    }
    .shape-item button {
      border: none;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <svg id="circle"></svg>
  <div class="controls">
    <button id="save-shape">Save Shape</button>
    <button id="clear-button">Clear Selection</button>
    <button id="clear-all">Clear All Shapes</button>
    <div id="chord-name"></div>
    <div class="shape-list" id="shape-list"></div>
    <input type="number" id="shape-id-input" placeholder="Enter shape decimal ID" />
    <button id="add-shape-by-id">Add Shape by ID</button>
    </div>
    <div id="app-version">Version: 0.1.9</div>
  </div>

  <script>
    const svg = document.getElementById("circle");
    const saveShapeButton = document.getElementById("save-shape");
    const clearAllButton = document.getElementById("clear-all");
    const clearButton = document.getElementById("clear-button");
    const shapeList = document.getElementById("shape-list");
    const chordNameDisplay = document.getElementById("chord-name");

    const chromatic = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
    const circleFifths = Array.from({ length: 12 }, (_, i) => chromatic[(0 + i * 7) % 12]);
    const selectedNotes = new Set();
    const savedShapes = [];
    const shapeColors = [
      "rgba(100,150,255,0.4)",
      "rgba(255,100,100,0.4)",
      "rgba(100,255,150,0.4)",
      "rgba(255,255,100,0.4)",
      "rgba(200,100,255,0.4)",
      "rgba(255,150,150,0.4)",
      "rgba(150,255,255,0.4)"
    ];

    const center = 200;
    const radius = 170;
    let rootIndex = 0;

    function getCoords(note) {
      const i = circleFifths.indexOf(note);
      const angle = (Math.PI * 2 * i / 12) - Math.PI / 2;
      return [
        center + radius * Math.cos(angle),
        center + radius * Math.sin(angle)
      ];
    }

    function getShapeBinaryDecimal(notes) {
  const binary = circleFifths.map(n => notes.has(n) ? "1" : "0");
  let min = parseInt(binary.join(""), 2);
  for (let i = 1; i < binary.length; i++) {
    const rotated = binary.slice(i).concat(binary.slice(0, i));
    const value = parseInt(rotated.join(""), 2);
    if (value < min) min = value;
  }
  return min;
}

    function displaySelectionInfo() {
      const intervals = Array.from(selectedNotes).map(n => (chromatic.indexOf(n) - rootIndex + 12) % 12).sort((a, b) => a - b);
      chordNameDisplay.textContent = intervals.length ? `Selected: ${intervals.join(", ")}` : "";
    }

    function draw() {
      svg.innerHTML = "";
      savedShapes.forEach(({ notes, color }) => {
        const coords = circleFifths.filter(n => notes.has(n)).map(n => getCoords(n));
        if (coords.length >= 2) {
          const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
          polygon.setAttribute("points", coords.map(([x, y]) => `${x},${y}`).join(" "));
          polygon.setAttribute("fill", color);
          polygon.setAttribute("stroke", color.replace(/0\.4\)$/, "1)"));
          svg.appendChild(polygon);
        }
      });

      const coords = circleFifths.filter(n => selectedNotes.has(n)).map(n => [n, ...getCoords(n)]);
      if (coords.length >= 2) {
        const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
        polygon.setAttribute("points", coords.map(c => `${c[1]},${c[2]}`).join(" "));
        polygon.setAttribute("fill", "rgba(150,150,150,0.4)");
        polygon.setAttribute("stroke", "gray");
        svg.appendChild(polygon);
      }

      circleFifths.forEach(note => {
        const [x, y] = getCoords(note);
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", x);
        circle.setAttribute("cy", y);
        circle.setAttribute("r", 20);
        circle.classList.add("note");
        circle.style.fill = selectedNotes.has(note) ? "lightblue" : "white";
        circle.addEventListener("click", () => {
  if (selectedNotes.has(note)) selectedNotes.delete(note);
  else selectedNotes.add(note);
  displaySelectionInfo();
  draw();

document.getElementById("add-shape-by-id").addEventListener("click", () => {
  const input = document.getElementById("shape-id-input");
  const decimal = parseInt(input.value);
  if (isNaN(decimal)) return;
  const binary = decimal.toString(2).padStart(12, "0");
  const notes = new Set();
  [...binary].forEach((bit, i) => {
    if (bit === "1") notes.add(circleFifths[i]);
  });
  const color = shapeColors[savedShapes.length % shapeColors.length];
  savedShapes.push({ notes, color });
  updateShapeList();
  draw();
});
});
          else selectedNotes.add(note);
          displaySelectionInfo();
          
});


});

draw();
        });
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", y);
        label.textContent = note;
        svg.appendChild(circle);
        svg.appendChild(label);
      });
    }

    function updateShapeList() {
      shapeList.innerHTML = "";
      savedShapes.forEach(({ notes }, index) => {
        const div = document.createElement("div");
        div.className = "shape-item";

        const shapeID = getShapeBinaryDecimal(notes);
        const label = document.createElement("span");
        label.textContent = `Shape ${shapeID}`;
        label.style.cursor = "pointer";
        label.onclick = () => {
          selectedNotes.clear();
          notes.forEach(n => selectedNotes.add(n));
          displaySelectionInfo();
          draw();
        };

        const mergeBtn = document.createElement("button");
        mergeBtn.textContent = "+";
        mergeBtn.title = "Merge into current";
        mergeBtn.style.background = "green";
        mergeBtn.style.marginRight = "5px";
        mergeBtn.onclick = () => {
          notes.forEach(n => selectedNotes.add(n));
          displaySelectionInfo();
          draw();
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "âœ–";
        deleteBtn.onclick = () => {
          savedShapes.splice(index, 1);
          updateShapeList();
          draw();
        };

        div.appendChild(label);
        div.appendChild(mergeBtn);
        div.appendChild(deleteBtn);
        shapeList.appendChild(div);
      });
    }

    saveShapeButton.addEventListener("click", () => {
      if (selectedNotes.size > 1) {
        const color = shapeColors[savedShapes.length % shapeColors.length];
        savedShapes.push({ notes: new Set(selectedNotes), color });
        updateShapeList();
        selectedNotes.clear();
        displaySelectionInfo();
        draw();
      }
    });

    clearButton.addEventListener("click", () => {
      selectedNotes.clear();
      displaySelectionInfo();
      draw();
    });

    clearAllButton.addEventListener("click", () => {
      savedShapes.length = 0;
      updateShapeList();
      draw();
    });

    draw();
  </script>
</body>
</html>
